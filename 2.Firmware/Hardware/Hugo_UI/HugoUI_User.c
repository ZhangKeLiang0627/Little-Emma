#include "HugoUI_User.h"
#include "Hugo_UI.h"
#include "HugoUI_BMP.h"
#include "OLED_User.h"
#include "malloc.h"
#include "oled.h"
#include "BEEPER.h"
#include "UART0.h"

#include "mpu6050.h"
#include "inv_mpu.h"
#include "inv_mpu_dmp_motion_driver.h" 

#include "Key.h"

#include "FileSystem.h"

#include "max30102.h"

/******************************图片存放区******************************/
const uint8_t Setting_BMP[] = {
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xE0,0x0F,0x00,0x00,0xE0,0x0F,0x00,0x00,
0x7C,0xFC,0xFF,0x3F,0x7C,0xFC,0xFF,0x3F,0x7C,0xFC,0xFF,0x3F,0xE0,0x0F,0x00,0x00,
0xE0,0x0F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0xF8,0x03,0x00,0x00,0xF8,0x03,0xFC,0xFF,0x1F,0x3F,0xFC,0xFF,0x1F,0x3F,
0xFC,0xFF,0x1F,0x3F,0x00,0x00,0xF8,0x03,0x00,0x00,0xF8,0x03,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xF0,0x07,0x00,
0x00,0xF0,0x07,0x00,0xFC,0x3F,0xFE,0x3F,0xFC,0x3F,0xFE,0x3F,0xFC,0x3F,0xFE,0x3F,
0x00,0xF0,0x07,0x00,0x00,0xF0,0x07,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 32*32 */
};

const uint8_t Poet_BMP[] = {
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x7E,0x00,0x00,0x00,0x7E,0x00,0x00,0x80,0xE7,0x01,
0x00,0x80,0xE7,0x01,0x00,0xE0,0x81,0x07,0x00,0xE0,0x81,0x07,0x00,0x78,0x18,0x06,
0x00,0x78,0x18,0x06,0x00,0x1E,0x86,0x07,0x00,0x1E,0x86,0x07,0x80,0x87,0xE1,0x01,
0x80,0x87,0xE1,0x01,0x80,0x61,0x78,0x00,0x80,0x61,0x78,0x00,0x80,0x19,0x1E,0x00,
0x80,0x19,0x1E,0x00,0x80,0x81,0x07,0x00,0x80,0x81,0x07,0x00,0x80,0xFF,0x01,0x00,
0x80,0xFF,0x01,0x00,0x60,0x00,0x00,0x00,0x60,0x00,0x00,0x00,0x18,0x00,0x00,0x00,
0x18,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 32*32 */
};

const u8 Robot_BMP[]= {
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0xE0,0x03,0x00,0x00,0xE0,0x03,0x00,0x00,0xE0,0x03,0x00,0x00,0xE0,0x03,0x00,
0x00,0xE0,0x03,0x00,0x00,0xE0,0x03,0x00,0x80,0xFF,0xFF,0x00,0x80,0xFF,0xFF,0x00,
0x80,0x01,0xC0,0x00,0x80,0x01,0xC0,0x00,0x98,0x19,0xCC,0x0C,0x98,0x19,0xCC,0x0C,
0x98,0x19,0xCC,0x0C,0x98,0x19,0xCC,0x0C,0x98,0x01,0xC0,0x0C,0x98,0x01,0xC0,0x0C,
0x98,0xE1,0xC3,0x0C,0x80,0xE1,0xC3,0x00,0x80,0x01,0xC0,0x00,0x80,0x01,0xC0,0x00,
0x80,0x01,0xC0,0x00,0x80,0xFF,0xFF,0x00,0x80,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 32*32 */

};

const u8 Knife_BMP[] = {
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x60,0xE0,0x07,
0x00,0x60,0xE0,0x07,0x00,0x60,0x18,0x18,0x00,0x60,0x18,0x18,0x80,0x61,0x06,0x18,
0x80,0x61,0x06,0x18,0x00,0x86,0x01,0x18,0x00,0x86,0x01,0x18,0x00,0x00,0x00,0x06,
0x00,0x00,0x00,0x06,0xF8,0x01,0x80,0x01,0xF8,0x01,0x80,0x01,0x00,0x06,0x60,0x00,
0x00,0x06,0x60,0x00,0x80,0x01,0x80,0x1F,0x80,0x01,0x80,0x1F,0x60,0x00,0x00,0x00,
0x60,0x00,0x00,0x00,0x18,0x80,0x61,0x00,0x18,0x80,0x61,0x00,0x18,0x60,0x86,0x01,
0x18,0x60,0x86,0x01,0x18,0x18,0x06,0x00,0x18,0x18,0x06,0x00,0xE0,0x07,0x06,0x00,
0xE0,0x07,0x06,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 32*32 */
};

const u8 Lighting_BMP[] = {
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x30,0x00,
0x00,0x00,0x30,0x00,0x00,0x00,0x3C,0x00,0x00,0x00,0x3C,0x00,0x00,0x00,0x0B,0x00,
0x00,0x00,0x0B,0x00,0x00,0xC0,0x08,0x00,0x00,0xC0,0x08,0x00,0x00,0x30,0x08,0x00,
0x00,0x30,0x08,0x00,0x00,0x0C,0xF8,0x01,0x00,0x0C,0xE0,0x01,0x00,0x03,0x60,0x00,
0x00,0x03,0x78,0x00,0xC0,0x03,0x18,0x00,0xC0,0x0F,0x1E,0x00,0x00,0x08,0x06,0x00,
0x00,0x88,0x07,0x00,0x00,0x88,0x01,0x00,0x00,0xA8,0x01,0x00,0x00,0x68,0x00,0x00,
0x00,0x68,0x00,0x00,0x00,0x1E,0x00,0x00,0x00,0x1E,0x00,0x00,0x00,0x06,0x00,0x00,
0x00,0x06,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 32*32 */
};

const u8 Cuteghost_BMP[] = {
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x7E,0x00,0x00,0x80,0xFF,0x00,0x00,0xE0,0xFF,0x03,0x00,0xF0,0xFF,0x07,0x00,
0xF8,0xCF,0x06,0x00,0xFC,0xCF,0x0C,0x00,0xD4,0xFF,0x0D,0x00,0xC0,0x3F,0x0F,0x00,
0xF0,0x0F,0x0E,0x00,0xC0,0x07,0x0C,0x00,0xE0,0x07,0x0C,0x00,0xF0,0x27,0x0C,0x00,
0xF8,0xFF,0x0C,0x00,0xFE,0xFF,0x0F,0x00,0xFF,0x9F,0x0F,0x00,0xFF,0xA7,0x0F,0x00,
0x3F,0xB8,0x07,0x01,0xFF,0xDF,0x87,0x01,0xFF,0xEF,0xC7,0x01,0xFF,0xF7,0xF7,0x00,
0xFF,0xF9,0x7B,0x00,0xFF,0xFC,0x3B,0x00,0xFF,0xFF,0x1B,0x00,0xFF,0xFF,0x03,0x00,
0xFF,0xFF,0x03,0x00,0xFF,0xFF,0x03,0x00,0xFF,0xFF,0x03,0x00,0xFF,0xFF,0x03,0x00,
/* 32*32 */

};

const u8 Myself_BMP[] = {
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x00,0x00,
0x80,0x04,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x60,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0xC0,0x07,0x00,0x00,0xEE,0x1F,0x00,0x00,0xFF,0x7F,0x00,
0x80,0xFF,0xFF,0x00,0xC0,0xFF,0xFF,0x01,0xC0,0xFF,0xFF,0x03,0xE0,0xCF,0xFF,0x03,
0xE0,0x87,0xFF,0x07,0xF0,0x07,0xFF,0x07,0xF0,0x07,0xFB,0x0F,0xF0,0x03,0xF2,0x0F,
0xF0,0x03,0xE0,0x0F,0xE0,0x3D,0xBC,0x07,0xC0,0x00,0x00,0x03,0xA0,0x38,0x1C,0x05,
0x20,0x10,0x08,0x04,0x20,0x00,0x00,0x04,0x40,0x00,0x00,0x02,0x80,0x00,0x00,0x01,
/* 32*32 */
};

const u8 SolidHreat_BMP[] = {
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x0F,0xF0,0x01,
0xE0,0x3F,0xFC,0x07,0xE0,0x3F,0xFC,0x07,0xF0,0x7F,0xFE,0x0F,0xFC,0xFF,0xFF,0x3F,
0xFC,0xFF,0xFF,0x3F,0xFC,0xFF,0xFF,0x3F,0xFC,0xFF,0xFF,0x3F,0xFC,0xFF,0xFF,0x3F,
0xFC,0xFF,0xFF,0x3F,0xFC,0xFF,0xFF,0x3F,0xFC,0xFF,0xFF,0x3F,0xF0,0xFF,0xFF,0x0F,
0xF0,0xFF,0xFF,0x0F,0xE0,0xFF,0xFF,0x07,0xE0,0xFF,0xFF,0x07,0x80,0xFF,0xFF,0x01,
0x00,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0x00,0x00,0xFC,0x3F,0x00,0x00,0xFC,0x3F,0x00,
0x00,0xF8,0x1F,0x00,0x00,0xF0,0x0F,0x00,0x00,0xF0,0x0F,0x00,0x00,0xC0,0x03,0x00,
0x00,0x80,0x01,0x00,0x00,0x80,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 32*32 */	
};

const u8 HollowHreat_BMP[] = {
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0xC0,0x0F,0xF0,0x03,0xC0,0x0F,0x00,0x00,0xF0,0x3F,0xFC,0x0F,
0xF0,0x3F,0x00,0x00,0xFC,0xFF,0xFF,0x3F,0xFC,0xFF,0x00,0x00,0xFC,0xFF,0xFF,0x3F,
0xFC,0xFF,0x00,0x00,0xFC,0xFF,0xFF,0x3F,0xFC,0xFF,0x00,0x00,0xF8,0xFF,0xFF,0x1F,
0xF0,0xFF,0x00,0x00,0xF0,0xFF,0xFF,0x0F,0xC0,0xFF,0x00,0x00,0xC0,0xFF,0xFF,0x03,
0x00,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0xFC,0x00,0x00,0x00,0xFC,0x3F,0x00,
0x00,0xF0,0x00,0x00,0x00,0xF0,0x0F,0x00,0x00,0xC0,0x00,0x00,0x00,0xC0,0x03,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 32*32 */	
};

const u8 Unicorn_BMP[] = {
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0C,0x0C,0x00,0x00,0x0C,0x0C,
0x00,0x00,0xCF,0x03,0x00,0x00,0xCF,0x03,0x00,0xFC,0xFF,0x03,0x00,0xFC,0xFF,0x03,
0x00,0xFC,0xF0,0x00,0x00,0xFC,0xF0,0x00,0xC0,0x3F,0xC0,0x00,0xC0,0x3F,0xC0,0x00,
0xC0,0x0F,0x0C,0x03,0xC0,0x0F,0x0C,0x03,0xC0,0xCF,0x00,0x03,0xC0,0xCF,0x00,0x03,
0xF0,0x03,0x03,0x03,0xF0,0x03,0x03,0x03,0xF0,0x03,0xFF,0x00,0xF0,0x03,0xFF,0x00,
0xF0,0x00,0x0C,0x00,0xF0,0x00,0x0C,0x00,0xC0,0x00,0x0C,0x00,0xC0,0x00,0x0C,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 32*32 */	
};

const u8 Home_BMP[] = {
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0xF0,0x03,0x00,0x00,0xF0,0x03,0x00,0x00,0xFC,0x0F,0x00,0x00,0xFC,0x0F,0x00,
0x00,0xFF,0x3F,0x00,0x00,0xFF,0x3F,0x00,0xC0,0xCF,0xF3,0x00,0xC0,0xCF,0xF3,0x00,
0xF0,0xFF,0xFF,0x03,0xF0,0xFF,0xFF,0x03,0xC0,0xFF,0xFC,0x00,0xC0,0xFF,0xFC,0x00,
0xC0,0xFF,0xFF,0x00,0xC0,0xFF,0xFF,0x00,0xC0,0xFF,0xFF,0x00,0xC0,0xFF,0xFF,0x00,
0xC0,0x3F,0xF0,0x00,0xC0,0x3F,0xF0,0x00,0x00,0x0F,0xC0,0x00,0x00,0x0F,0xC0,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 32*32 */	
};

const u8 TreasureBox_BMP[] = {
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0xF0,0xFF,0xFF,0x0F,0xF0,0xFF,0xFF,0x0F,0x0C,0x03,0x00,0x30,0x0C,0x03,0x00,0x30,
0x03,0x0C,0x00,0xC0,0x03,0x0C,0x00,0xC0,0x03,0x0C,0x00,0xC0,0x03,0x0C,0x00,0xC0,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x03,0x0C,0x03,0xC3,0x03,0x0C,0x03,0xC3,
0x03,0x0C,0x33,0xC3,0x03,0x0C,0x33,0xC3,0x03,0x0C,0x03,0xC3,0x03,0x0C,0x03,0xC3,
0x0F,0x0F,0xFC,0xC0,0x0F,0x0F,0xFC,0xC0,0x03,0x0C,0x00,0xC0,0x03,0x0C,0x00,0xC0,
0x03,0x0C,0x00,0xC0,0x03,0x0C,0x00,0xC0,0x03,0x0C,0x00,0xC0,0x03,0x0C,0x00,0xC0,
0xFC,0xFF,0xFF,0x3F,0xFC,0xFF,0xFF,0x3F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 32*32 */	
};
	

const u8 HeadSculpture_BMP[] = {
0xD6,0xF8,0xFF,0xE7,0x1F,0x4B,0xFC,0xFF,0x8C,0x3F,0x17,0xC8,0x7F,0x10,0x3A,0x0F,
0x80,0xFF,0x00,0x30,0x8F,0xD3,0xFF,0x4D,0x70,0xE7,0xEF,0xFF,0xFB,0x76,0xF7,0xFF,
0xFF,0xFF,0x7D,0xFB,0xFF,0xFB,0xFF,0xFF,0xFF,0xFF,0xFB,0xFF,0xFF,0xFF,0xFF,0xF9,
0xFF,0xFF,0xFF,0xFF,0xB9,0xFF,0xFF,0x7F,0xFF,0x78,0xFB,0xFF,0x7F,0xDF,0x70,0xDB,
0xFF,0x6F,0xDF,0x70,0x9B,0xFF,0x6F,0x4D,0x70,0xBA,0x7F,0x2F,0x45,0x30,0x32,0x7F,
0x27,0x41,0x20,0x20,0x7F,0x07,0x3F,0xA0,0x1F,0x7E,0xE7,0x40,0x40,0xE0,0x3E,0x07,
0x00,0x00,0x00,0x3E,0x0F,0x1E,0x01,0x1E,0x1C,0x0E,0x25,0x01,0x25,0x1C,0x8E,0x0C,
0x02,0x4C,0x2C,0x99,0x08,0x02,0x48,0x44,0x11,0x00,0x00,0x00,0x46,0x11,0x00,0x00,
0x00,0x42,0x11,0x00,0x00,0x00,0x21,0x22,0x00,0x00,0x00,0x11,0x24,0x00,0x02,0x00,
0x09,0x28,0x00,0x02,0x80,0x04,0x50,0x00,0x02,0x80,0x03,0x60,0x00,0x00,0x40,0x00,
0x80,0x00,0x00,0x40,0x00,0x80,0x00,0x00,0x20,0x00,0x00,0x01,0x0E,0x20,0x00,0x00,
0x02,0x00,0x10,0x00,0x00,0x04,0x00,0x08,0x00,0x00,0x0C,0x00,0x04,0x00,0x00,0x18,
0x00,0x02,0x00,0x00,0x7E,0x80,0x03,0x00,0xC0,0xE9,0x61,0x06,0x00,0x20,0x88,0x1F,
0x1A,0x00,0x10,0x0A,0x00,0x62,0x00,0x08,0x0A,0x00,0x8A,0x00,0x08,0x09,0x00,0x8A,
0x00,0x08,0x09,0x00,0x12,0x07,0x04,0x09,0x00,0x12,0x09,0x07,0x05,0x00,0x12,0x1A,
0x04,0x03,0x00,0x14,0x62,0x02,0x01,0x00,0x08,0x82,
/* 40*50 */	
};

/******************************图片存放区******************************/

/******************************变量存放区******************************/

// 开关控件变量
uint8_t SmoothAnimation_Flag = true; // 缓动动画标志位 // 缓动动画flag需要在HugoUI_Control中使用，建议不要改动！（don't change this one!!!）
uint8_t OptionStripFixedLength_Flag = false;

uint8_t CheckBox1_flag = true;
uint8_t CheckBox2_flag = false;
uint8_t CheckBox3_flag = false;

uint8_t Switch1_flag = true;
uint8_t Switch2_flag = false;
uint8_t Switch3_flag = false;
uint8_t BeeperEnable_flag = true;
uint8_t PageListMode_flag = false;


// 滑动条变量
paramType val1 = 0.11f;
paramType val2 = 0.22f;
paramType val3 = 0.33f;

paramType Spo2MinLimit = 90;
paramType HRMaxLimit = 125;
paramType HRMinLimit = 40;

paramType BeeperLoud = 0;

paramType ScreenBrightness = 255;
paramType MenuScroll = 0;

float pitch,roll,yaw; 		
short aacx,aacy,aacz;		
short gyrox,gyroy,gyroz;

extern int16_t icon_move_x;

extern uint32_t Time_10ms;

/******************************变量存放区******************************/

/******************************血氧仪变量******************************/
extern uint32_t max30102_data[2];
extern int32_t HeartRate;
extern int32_t SpO2;

extern uint8_t max30102_set_flag;
/******************************血氧仪变量******************************/

/******************************结构体存放区******************************/


//由于sizeof的原理是在编译阶段由编译器替换数组大小，因此我们无法计算指针的sizeof！需要在位图的第一个字节填写 n 阶矩阵图像

uint8_t* Switch_space[] = {
    &SmoothAnimation_Flag, // 缓动动画flag需要在HugoUI_Control中使用，建议不要改动！（don't change this one!!!）
    &OptionStripFixedLength_Flag,
    &CheckBox1_flag,
    &CheckBox2_flag,
    &CheckBox3_flag,
    &Switch1_flag,
    &Switch2_flag,
    &Switch3_flag,
    &Beeper0.Beeper_Enable, // 蜂鸣器使能标志位
    &PageListMode_flag,
    
};


/**
*    @结构体 Slide_Bar Slide_space[]
*    @brief 滑动条控件 用于存储滑动条控件的值(即储存param)
*    @param none
*
*    @变量
*        int   val    值
*        int   min  最小值
*        int   max  最大值
*        int   step 步进
*/

struct Slide_Bar Slide_space[] = {
    {(float*) &ScreenBrightness,      1,   255,     16},        //亮度调整
    
    {(float*) &val1,                  0,   10,    0.1},        //param
    {(float*) &val2,                  0,   10,    0.5},
    {(float*) &val3,                  0,   10,    0.01},
    {(float*) &Beeper0.Sound_Loud,    0,   98,       5}, // 蜂鸣器响度
	{(float*) &Spo2MinLimit,          0,   99,       1}, // 血氧下限
	{(float*) &HRMaxLimit,           60,  150,       1}, // 脉率上限
	{(float*) &HRMinLimit,            0,   59,       1}, // 脉率下限
	
	
};


/******************************结构体存放区******************************/


void HugoUI_InitLayout(void)
{
    /* 注册Page */
    HugoUIPage_t *pageMain = AddPage(PAGE_CUSTOM, "pageMain");
    HugoUIPage_t *pageSetting = AddPage(PAGE_LIST, "pageSetting");
    HugoUIPage_t *pagePID = AddPage(PAGE_LIST, "pagePID");
    HugoUIPage_t *pageSpo2HRst = AddPage(PAGE_LIST, "pageSpo2HRst");


    /* 注册 Item */ 
    // PageMain
    pageMain->AddItem(pageMain, "Setting", ITEM_JUMP_PAGE)
            ->SetJumpId(pageSetting->pageId, 0)
            ->SetIconSrc(Setting_BMP);
	
	pageMain->AddItem(pageMain, "Oximeter", ITEM_CALL_FUNCTION, EventPulseOximeter)
            ->SetIconSrc(HollowHreat_BMP);

    pageMain->AddItem(pageMain, "Spo2&HRst", ITEM_JUMP_PAGE)
            ->SetJumpId(pageSpo2HRst->pageId, 0)
            ->SetIconSrc(Lighting_BMP);
    
    pageMain->AddItem(pageMain, "DVA!", ITEM_CHECKBOX, &CheckBox1_flag, NULL)
            ->SetIconSrc(Robot_BMP);

    pageMain->AddItem(pageMain, "Gyro", ITEM_CALL_FUNCTION, EventShowGyroUI)
            ->SetIconSrc(Poet_BMP);

    pageMain->AddItem(pageMain, "Checkbox3", ITEM_CHECKBOX, &CheckBox3_flag, NULL)
            ->SetIconSrc(Knife_BMP);

    pageMain->AddItem(pageMain, "Cuteghost", ITEM_CALL_FUNCTION, EventChartTest)
            ->SetIconSrc(Cuteghost_BMP);

	pageMain->AddItem(pageMain, "Unicorn", ITEM_PAGE_DESCRIPTION)
            ->SetIconSrc(Unicorn_BMP);
			
	pageMain->AddItem(pageMain, "???", ITEM_CALL_FUNCTION, EventTreasureBox)
            ->SetIconSrc(TreasureBox_BMP);
			
    pageMain->AddItem(pageMain, "About", ITEM_CALL_FUNCTION, EventShowAboutUI)
            ->SetIconSrc(Home_BMP);

    // PageSetting
    pageSetting->AddItem(pageSetting, "Setting", ITEM_PAGE_DESCRIPTION);
    pageSetting->AddItem(pageSetting, "PID Editor", ITEM_JUMP_PAGE)
               ->SetJumpId(pagePID->pageId, 0);
    
    pageSetting->AddItem(pageSetting, "SmoothAnim", ITEM_SWITCH, &SmoothAnimation_Flag, NULL);
    pageSetting->AddItem(pageSetting, "LightLevel", ITEM_CHANGE_VALUE, &ScreenBrightness, Oled_EventUpdateOledLightLevel);
    pageSetting->AddItem(pageSetting, "BeepEnable", ITEM_SWITCH, &BeeperEnable_flag, EventBeeperEnableConfig);
    pageSetting->AddItem(pageSetting, "Page2List", ITEM_SWITCH, &PageListMode_flag, NULL);
    pageSetting->AddItem(pageSetting, "Volume Ctrl", ITEM_CHANGE_VALUE, &BeeperLoud, EventBeeperVolumeControl);
    pageSetting->AddItem(pageSetting, "SaveAll", ITEM_CALL_FUNCTION, EventSaveSettingConfig);

    
    pageSetting->AddItem(pageSetting, "Exit", ITEM_JUMP_PAGE)
               ->SetJumpId(pageMain->pageId, 0);

    // PageSpo2&HRst
    pageSpo2HRst->AddItem(pageSpo2HRst, "Spo2&HRst", ITEM_PAGE_DESCRIPTION);
    pageSpo2HRst->AddItem(pageSpo2HRst, "Spo2MinVal", ITEM_CHANGE_VALUE, &Spo2MinLimit, NULL);
    pageSpo2HRst->AddItem(pageSpo2HRst, "HRMaxVal", ITEM_CHANGE_VALUE, &HRMaxLimit, NULL);
    pageSpo2HRst->AddItem(pageSpo2HRst, "HRMinVal", ITEM_CHANGE_VALUE, &HRMinLimit, NULL);
    pageSpo2HRst->AddItem(pageSpo2HRst, "Exit", ITEM_JUMP_PAGE)
                ->SetJumpId(pageMain->pageId, 2);


    // PagePID
    pagePID->AddItem(pagePID, "PID Editor", ITEM_PAGE_DESCRIPTION);
    pagePID->AddItem(pagePID, "PID_Kp", ITEM_CHANGE_VALUE, &val1, NULL);
    pagePID->AddItem(pagePID, "PID_Ki", ITEM_CHANGE_VALUE, &val2, NULL);
    pagePID->AddItem(pagePID, "PID_Kd", ITEM_CHANGE_VALUE, &val3, NULL);
    pagePID->AddItem(pagePID, "Exit", ITEM_JUMP_PAGE)
           ->SetJumpId(pageSetting->pageId, 1);


    // ItemTail = ItemHead;
    // while(ItemTail != NULL)
    // {
    //     printf("name:%s\r\n", ItemTail->title);
    //     printf("lid:%d\r\n", ItemTail->lineId);
    //     printf("id:%d\r\n", ItemTail->itemId);
    //     ItemTail = ItemTail->next;
    // }
    // pageTail = pageHead;
    // while(pageTail != NULL)
    // {
    //     printf("name:%s\r\n", pageTail->title);
    //     printf("id:%d\r\n", pageTail->pageId);
    //     pageTail = pageTail->next;
    // }

    printf("内存占用情况：%d\r\n", my_mem_perused(SRAMIN));
    printf("itemMax:%d\r\n",pageMain->itemMax);
}

/* Little Event */
/* 对于SSD1306型号的Oled的调节屏幕亮度的函数 */
void EventUpdateOledLightLevel(void)
{
    WriteCmd(0x81); /*contrast control*/ 
	WriteCmd((uint8_t)*Slide_space[Slide_space_ScreenBrightness].val); /*255*/ 
}

/* 蜂鸣器使能事件函数 */
void EventBeeperEnableConfig(void)
{
    Beeper0.Beeper_Enable = BeeperEnable_flag;
}

/* 蜂鸣器音量控制事件函数 */
void EventBeeperVolumeControl(void)
{
    Beeper0.Sound_Loud = (uint8_t)BeeperLoud;
}

/* Large Event */

extern uint8_t mpu6050_set_flag;
extern uint8_t sht30_set_flag;

float Temperature, Humidity;




/* 陀螺仪事件函数 */
void EventShowGyroUI(void)
{
    static uint8_t res1 = 1, res2 = 1;
    static int16_t GyroFrameBox_Width = 0, GyroFrameBox_Width_trg = 0;

    Oled_u8g2_ShowStr(0,13,"IMU:");
    if(!res1 && !res2) Oled_u8g2_ShowStr(100,13,"OK");
    else 
	{
		Oled_u8g2_ShowStr(100,13,"ERR"); 
		Oled_u8g2_SetFont(u8g2_font_wqy12_t_chinese3);
		Oled_u8g2_ShowUTF8((128 - Oled_u8g2_Get_UTF8_ASCII_PixLen("璇风Init瀹"))/2, 48, "璇风Init瀹"); // 请等待初始化完成
		Oled_u8g2_SetFont(u8g2_font_profont15_mr);
	}	

    if(res1 == 1)
    {
        res1 = MPU_Init();
	    printf("MPU_Init = %d\r\n", res1);
        HugoUISendBuffer();
    }
	if(res2 == 1)
    {
		uint16_t InitTimeout = 0;
		while(res2)
		{
			res2 = mpu_dmp_init();
			
			InitTimeout ++;
			if(InitTimeout > 10000) break;
		}
	    printf("mpu_dmp_Init = %d\r\n", res2);
    }

    if(mpu6050_set_flag && !res1 && !res2)
    {
        mpu6050_set_flag = 0;
    	mpu_dmp_get_data(&pitch,&roll,&yaw);
    	printf("pitch = %.1f ", pitch);
    	printf("roll = %.1f ", roll);
    	printf("yaw = %.1f\r\n", yaw);
        if(pitch > 10 || pitch < -10)
        {
            GyroFrameBox_Width_trg = 84;
        }else GyroFrameBox_Width_trg = 0;
    }
    
    Oled_u8g2_ShowFloat(50,13,roll,2,2);
    Oled_u8g2_ShowFloat(50,26,yaw,2,2);

    Oled_u8g2_ShowFloat(0,26,pitch,2,2);

    Oled_u8g2_SetDrawColor(2);
    Oled_u8g2_DrawBox(0, 0, GyroFrameBox_Width, 32);
    Oled_u8g2_DrawTriangle(GyroFrameBox_Width, 0, GyroFrameBox_Width, 32, GyroFrameBox_Width > 24 ? GyroFrameBox_Width + 24 : GyroFrameBox_Width, 32);
    Oled_u8g2_SetDrawColor(1);
    
    HugoUI_Run(&GyroFrameBox_Width, &GyroFrameBox_Width_trg, 4, 8);
	
	if(KeyNum == 2)
	{
		icon_move_x = 0; //倘若跳转到custom界面可以起到一个复位动效
	}

}

/* About的应用事件函数 */
void EventShowAboutUI(void)
{	
	static int16_t motion_a = 80, motion_a_trg = 0;
	Oled_u8g2_ShowBMP(motion_a, 0, 40, 50, HeadSculpture_BMP);
	
	Oled_u8g2_SetDrawColor(2);
	Oled_u8g2_ShowStr(50, FONT_HEIGHT, "Little-Emma");
	Oled_u8g2_ShowStr(50, FONT_HEIGHT*2, "SW-Ver 1.4");
	Oled_u8g2_ShowStr(50, FONT_HEIGHT*3, " Power by");
	Oled_u8g2_ShowStr(50, FONT_HEIGHT*4, " @DogeTeam");
	Oled_u8g2_DrawRBox(97, 3, 31, FONT_HEIGHT, 0);
	Oled_u8g2_SetDrawColor(1);
	HugoUI_Run(&motion_a, &motion_a_trg, 4, 8);
	
	if(KeyNum == 2)
	{
		motion_a = 80;
		icon_move_x = 128; //倘若跳转到custom界面可以起到一个复位动效
	}
}


extern uint8_t peakfound_flag;
extern uint8_t fingerfound_flag;

/* 血氧仪事件函数 */
void EventPulseOximeter(void)
{
	static uint8_t PulseOximeterEnter_flag = true; // 进入血氧界面的标志位
	static int16_t Oximeter_x = 0, Oximeter_x_trg = 0;
	static int16_t Oximeterbox_a = 0, Oximeterbox_a_trg = 20;
	static int16_t Oximeterbox_width = 128, Oximeterbox_width_trg = 98;
	static int16_t Oximeterbox_height = 74, Oximeterbox_height_trg = 43;
	static int16_t HRBar_height = 0, HRBar_height_trg = 0;
	static int16_t finger_x = 0, finger_x_trg = 96;
	
	if(PulseOximeterEnter_flag)
	{
		uint32_t ThisMoment = Time_10ms;
		max30102_init(); // 初始化MAX30102
		while(Time_10ms - ThisMoment < 256)
		{
			Oled_u8g2_ClearBuffer();
			
			Oled_u8g2_ShowStr(20,20,"Use it->>");
			Oled_u8g2_ShowStr(5,40,"LIKE TIHS!!!");
			
			Oled_u8g2_SetFont(u8g2_font_wqy12_t_chinese3);
			Oled_u8g2_ShowUTF8((128 - Oled_u8g2_Get_UTF8_ASCII_PixLen("璧拌ANIMATION!"))/2,63,"璧拌ANIMATION!"); // str:短按跳过动画
			Oled_u8g2_SetFont(u8g2_font_profont15_mr);
			
			Oled_u8g2_ShowBMP(finger_x,0,32,46,Finger_BMP);
			
			Oled_u8g2_SetDrawColor(2);
			Oled_u8g2_DrawBox(0, 50, (Time_10ms-ThisMoment)/2, 14);
			Oled_u8g2_SetDrawColor(1);
			HugoUI_Run(&finger_x, &finger_x_trg, 4, 8);
			Oled_u8g2_SendBuffer();
			
			if(Key_KeyNumber == 1) // 短按跳过
			{
				finger_x = 0;
				PulseOximeterEnter_flag = false;
				break;
			}
		}
		finger_x = 0;
		PulseOximeterEnter_flag = false;
	}
	
	/* 血氧数据获取 */
	if(MAX30102_Get_DATA(&HeartRate,&SpO2,max30102_data) == MAX30102_DATA_OK)
	{
//		printf("HR:%d  /min   ", HeartRate);
//		printf("SP02:%d  %%\r\n", SpO2);
	}
	
	
	/* 图形界面 */
	Oled_u8g2_ShowStr(Oximeter_x + 5, 13, "  HR/bpm  SPO2/%");
	
//	Oled_u8g2_ShowStr(Oximeter_x + 28, 13 + 40, "bpm");
//	Oled_u8g2_ShowStr(Oximeter_x + 80, 13 + 40, "%");
	Oled_u8g2_ShowBMP(0,0,16,16,LittleHreat_BMP); // 小爱心
	
	if(peakfound_flag) // 计算HR条
	{
		HRBar_height_trg = 44;
		if(Beeper0.Beeper_Continue_Flag == 0) // 防止连叫
			Beeper_Perform(BEEPER_PULSE);
	}	
	else if(!peakfound_flag && HRBar_height == 44) HRBar_height_trg = 0;
	
	if((SpO2 > 0 && SpO2 < Spo2MinLimit) || (HeartRate > 0 && HeartRate < HRMinLimit) || HeartRate > HRMaxLimit) // 超限报警
	{
		if(Beeper0.Beeper_Continue_Flag == 0) // 防止连叫
			Beeper_Perform(BEEP2);
	}
	
	Oled_u8g2_DrawBox(3 - Oximeter_x*2.2f,20,10,HRBar_height); // HR条
	
	if(fingerfound_flag) Oled_u8g2_ShowStr(Oximeter_x/0.8f + 82, 57, "[OK]"); // 画导联状态
	else Oled_u8g2_ShowStr(Oximeter_x/0.8f + 82, 57, "[ERR]");
	
	Oled_u8g2_SetFont(u8g2_font_luBS14_tr); // 显示脉率血氧
	
//	Oled_u8g2_ShowStr(25, 40, "71");
	Oled_u8g2_ShowNum(Oximeter_x/1.5f + 25, 40, HeartRate);

//	Oled_u8g2_ShowStr(70, 40, "99");
//	Oled_u8g2_ShowFloat(70, 40, SpO2, 2, 2);
	Oled_u8g2_ShowNum(Oximeter_x + 80, 40, SpO2);
	
	Oled_u8g2_SetFont(u8g2_font_profont15_mr);
	
	Oled_u8g2_SetDrawColor(2);
//	Oled_u8g2_DrawRBox(20, 20, 98, 44, 4);
	Oled_u8g2_DrawRBox(Oximeter_x + Oximeterbox_a, Oximeterbox_a, Oximeterbox_width, Oximeterbox_height, 4); // 聚焦框框
	Oled_u8g2_SetDrawColor(1);
	
	if(HeartRate < 10 || HeartRate > 150) // 手指提示
	{
		Oximeter_x_trg = -32;
		Oled_u8g2_ShowBMP(Oximeter_x + 128,0,32,46,Finger_BMP);
		
		Oled_u8g2_SetFont(u8g2_font_wqy12_t_chinese3);
		Oled_u8g2_ShowUTF8(Oximeter_x + 133,63,"璇风ㄩ!"); // str:请用！
		Oled_u8g2_SetFont(u8g2_font_profont15_mr);
	}else Oximeter_x_trg = 0;
	
	HugoUI_Run(&Oximeter_x, &Oximeter_x_trg, 2, 8);
	HugoUI_Run(&HRBar_height, &HRBar_height_trg, 4, 8);
	HugoUI_Run(&Oximeterbox_a, &Oximeterbox_a_trg, 2, 8);
	HugoUI_Run(&Oximeterbox_height, &Oximeterbox_height_trg, 3, 8);
	HugoUI_Run(&Oximeterbox_width, &Oximeterbox_width_trg, 3, 8);
	
	if(KeyNum == 2)
	{
		icon_move_x = 128; //倘若跳转到custom界面可以起到一个复位动效
		
		Oximeterbox_a = 0;
		Oximeterbox_width = 128;
		Oximeterbox_height = 74;
		
		PulseOximeterEnter_flag = true;
	}
	
}


/* TreasureBox的事件函数 */
void EventTreasureBox(void)
{
    static uint8_t i = 0;

    if((Time_10ms%20) == 0)
	{
		i++;
		printf("ok!\r\n");
	}
    if(i>5) i=0;

    Oled_u8g2_ShowBMP(48,16,32,32,Cat_Animation_32[i]);

}


/* 波形绘制的测试事件函数 */
void EventChartTest(void)
{
	static int16_t Chart_x = 0, Chart_x_trg = 0;
	static int16_t Chartbox_a = 0, Chartbox_a_trg = 20;
	static int16_t Chartbox_width = 128, Chartbox_width_trg = 88;
	static int16_t Chartbox_height = 74, Chartbox_height_trg = 43;
	static uint32_t LastMoment = 0;
	static int16_t Wave[78];
	static uint8_t Wave_x = 0;
	/* 功能实现 */
	if(Time_10ms - LastMoment > 5)
	{
		Wave_x ++;
		
		LastMoment = Time_10ms;
		if(Wave_x > 78) Wave_x = 0;
	}
	
	if(EncoderNum == 1) Wave[Wave_x]+=3;
	if(EncoderNum == 2) Wave[Wave_x]-=2;
	
	/* 图形界面 */
	
	// 标题
	Oled_u8g2_ShowStr(20, 13, "Wave-t:");
	
	//绘制波形
	for(uint8_t i = 1; i < 79; i++)
	{
		Oled_u8g2_DrawLine(i-1 + 25, Wave[i-1] + 41, i + 25, Wave[i] + 41);
	}
		
	
	Oled_u8g2_DrawLine(Wave_x + 25, 59, Wave_x + 25, 61); // 当前运行指示标
	
	// 绘制坐标轴
	Oled_u8g2_DrawLine(25, 25, 25, 58); // 竖轴
	Oled_u8g2_DrawLine(25, 25, 22, 28); // 箭头
	Oled_u8g2_DrawLine(25, 58, 103, 58); // 横轴
	Oled_u8g2_DrawLine(103, 58, 100, 61); // 箭头
	
	
	// 绘制聚焦框框
	Oled_u8g2_SetDrawColor(2);
//	Oled_u8g2_DrawRBox(20, 20, 88, 44, 4);
	Oled_u8g2_DrawRBox(Chartbox_a, Chartbox_a, Chartbox_width, Chartbox_height, 4); // 聚焦框框
	Oled_u8g2_SetDrawColor(1);
	
	HugoUI_Run(&Chart_x, &Chart_x_trg, 2, 8);
	HugoUI_Run(&Chartbox_a, &Chartbox_a_trg, 2, 8);
	HugoUI_Run(&Chartbox_height, &Chartbox_height_trg, 3, 8);
	HugoUI_Run(&Chartbox_width, &Chartbox_width_trg, 3, 8);
	
	if(KeyNum == 2)
	{
		Chart_x = 0;
		Chartbox_a = 0;
		Chartbox_width = 128;
		Chartbox_height = 74;
	}

}

